!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const o of e)if("childList"===o.type)for(const e of o.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e="http://localhost:8000",t={api:{endpoints:{health:`${e}/healthz`,llmModels:`${e}/llm-models`,upload:`${e}/upload`,generate:`${e}/generate`,testcases:`${e}/testcases`,statistics:`${e}/statistics`,exportExcel:`${e}/export/excel`}}}.api.endpoints,o=e=>document.querySelector(e),n=e=>document.querySelectorAll(e);let s=null,a=!1,r={},i=null;const l={sourceBtns:n(".source-btn"),textSource:o("#textSource"),fileSource:o("#fileSource"),projectName:o("#projectName"),requirementsText:o("#requirementsText"),fileInput:o("#file"),formFactor:o("#formFactor"),testLevelCheckboxes:n('input[name="testLevel"]'),selectAllCheckbox:o("#selectAll"),llmModel:o("#llmModel"),advancedToggle:o("#advancedToggle"),advancedOptions:o("#advancedOptions"),toggleIcon:o(".toggle-icon"),count:o("#count"),topk:o("#topk"),docId:o("#docId"),form:o("#testGenForm"),generateBtn:o("#btnGenerate"),exportBtn:o("#btnExport"),exportMenu:o("#exportMenu"),exportJson:o("#exportJson"),exportExcel:o("#exportExcel"),latestBtn:o("#btnLatest"),uploadStatus:o("#uploadStatus"),genStatus:o("#genStatus"),resultsSection:o("#resultsSection"),latest:o("#latest"),statsSection:o("#statsSection"),totalCases:o("#totalCases"),highPriority:o("#highPriority"),mediumPriority:o("#mediumPriority"),lowPriority:o("#lowPriority")};async function c(e){const n=e.target.files;if(!n||0===n.length)return void d("Please select a file.","error");const a=n[0],r=a.name.toLowerCase();if(![".txt",".md",".doc",".docx",".pdf"].some(e=>r.endsWith(e.replace(".",""))))return void d("Please upload a valid file type (.txt, .md, .doc, .docx, .pdf)","error");if(a.size>10485760)d("File size must be less than 10MB","error");else try{d("Uploading file...","loading");const e=new FormData;e.append("file",a);const n=await fetch(t.upload,{method:"POST",body:e}),r=await n.json();n.ok?(s=r.doc_id,l.docId.value=s,d("File uploaded successfully! Uploading to Open AI Vector Store in background...","success"),function(e){o(".file-upload-placeholder").innerHTML=`\n    <div class="upload-icon">‚úÖ</div>\n    <div class="upload-text">\n      <span class="upload-primary">${e}</span>\n      <span class="upload-secondary">File uploaded successfully</span>\n    </div>\n  `}(a.name)):d(`Upload failed: ${r.detail||n.statusText}`,"error")}catch(i){d(`Upload failed: ${i.message}`,"error")}}function d(e,t){l.uploadStatus.textContent=e,l.uploadStatus.className=`upload-status ${t}`}function u(e,t){l.genStatus.textContent=e,l.genStatus.className=`generation-status ${t}`}async function p(e){if(e.preventDefault(),!a&&function(){if(!i||!l.llmModel.value)return u("‚ùå Please select an AI model.","error"),l.llmModel.focus(),!1;const e=l.requirementsText.value.trim(),t=s||l.fileInput.files.length>0,o=!l.textSource.classList.contains("hidden");if(o&&!e)return u("‚ùå Please enter your requirements text.","error"),l.requirementsText.focus(),!1;if(!o&&!t)return u("‚ùå Please upload a requirements file.","error"),!1;if(0===Array.from(l.testLevelCheckboxes).filter(e=>e.checked).length)return u("‚ùå Please select at least one test level.","error"),!1;return!0}()){a=!0,m(!0);try{const e=function(){const e=!l.textSource.classList.contains("hidden"),t=Array.from(l.testLevelCheckboxes).filter(e=>e.checked).map(e=>e.value),o={project_name:l.projectName.value.trim(),requirements_text:e?l.requirementsText.value.trim():null,doc_id:e?null:l.docId.value||s,form_factor:l.formFactor.value,test_levels:t,count:parseInt(l.count.value)||40,top_k:parseInt(l.topk.value)||12,modes:[l.formFactor.value],llm_model:i.id,llm_provider:i.provider};return o}();u("ü§ñ Generating test cases... This may take a moment.","loading");const o=await fetch(t.generate,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),n=await o.json();o.ok?(u(`‚úÖ Successfully generated ${n.count} test cases!`,"success"),function(e){l.resultsSection.classList.remove("hidden"),l.latest.textContent=JSON.stringify(e,null,2),g(),l.resultsSection.scrollIntoView({behavior:"smooth"})}(n)):u(`‚ùå Generation failed: ${n.detail||o.statusText}`,"error")}catch(o){u(`‚ùå Generation failed: ${o.message}`,"error")}finally{a=!1,m(!1)}}}function m(e){e?(l.generateBtn.disabled=!0,l.generateBtn.innerHTML='\n      <span class="btn-icon loading">‚è≥</span>\n      Generating...\n    '):(l.generateBtn.disabled=!1,l.generateBtn.innerHTML='\n      <span class="btn-icon">‚ö°</span>\n      Generate Test Cases\n    ')}async function f(){try{const e=await fetch(t.testcases),o=await e.json();e.ok?(l.latest.textContent=JSON.stringify(o,null,2),l.resultsSection.classList.remove("hidden"),g()):alert("Failed to fetch latest results: "+(o.detail||e.statusText))}catch(e){alert("Error fetching results: "+e.message)}}function v(){const e=l.latest.textContent;if(e)try{const t=JSON.parse(e),o=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),n=URL.createObjectURL(o),s=document.createElement("a");s.href=n,s.download=`test-cases-${(new Date).toISOString().slice(0,10)}.json`,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(n),l.exportBtn.parentElement.classList.remove("open"),l.exportMenu.classList.add("hidden")}catch(t){alert("Error exporting results: "+t.message)}else alert("No results to export. Please generate test cases first.")}async function h(){try{u("üìä Generating Excel file...","loading");const e=await fetch(t.exportExcel);if(e.ok){const t=e.headers.get("content-disposition");let o="test-cases.xlsx";if(t){const e=t.match(/filename="?([^"]+)"?/);e&&(o=e[1])}const n=await e.blob(),s=URL.createObjectURL(n),a=document.createElement("a");a.href=s,a.download=o,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(s),u("‚úÖ Excel file downloaded successfully!","success")}else{u(`‚ùå Export failed: ${(await e.json()).detail||e.statusText}`,"error")}}catch(e){u(`‚ùå Export failed: ${e.message}`,"error")}finally{l.exportBtn.parentElement.classList.remove("open"),l.exportMenu.classList.add("hidden")}}async function g(){try{const e=await fetch(t.statistics);if(e.ok){const t=await e.json();l.totalCases&&(l.totalCases.textContent=t.total_cases),l.highPriority&&(l.highPriority.textContent=t.high_priority),l.mediumPriority&&(l.mediumPriority.textContent=t.medium_priority),l.lowPriority&&(l.lowPriority.textContent=t.low_priority),l.statsSection&&t.total_cases>0&&l.statsSection.classList.remove("hidden")}}catch(e){console.error("Failed to update statistics:",e)}}function x(){l.llmModel.innerHTML='\n    <option value="">Select an AI model...</option>\n    <optgroup label="OpenAI">\n      <option value="gpt-4o" data-provider="openai">GPT-4o (Latest)</option>\n      <option value="gpt-4" data-provider="openai">GPT-4</option>\n      <option value="gpt-3.5-turbo" data-provider="openai">GPT-3.5 Turbo</option>\n    </optgroup>\n    <optgroup label="LLAMA3">\n      <option value="llama3" data-provider="llama3">LLAMA3 8B</option>\n    </optgroup>\n  '}function L(){const e=l.llmModel.selectedOptions[0];if(!e||!e.value)return;const t=e.value,n=e.getAttribute("data-provider"),s=e.getAttribute("data-description");i={id:t,provider:n,description:s},function(e){const t=o(".model-info");t&&t.remove();if(e){const t=document.createElement("div");t.className="model-info",t.textContent=`‚ÑπÔ∏è ${e}`,l.llmModel.parentNode.appendChild(t)}}(s)}document.addEventListener("DOMContentLoaded",function(){l.sourceBtns.forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.source;l.sourceBtns.forEach(e=>e.classList.remove("active")),e.classList.add("active"),"text"===t?(l.textSource.classList.remove("hidden"),l.fileSource.classList.add("hidden")):(l.textSource.classList.add("hidden"),l.fileSource.classList.remove("hidden"))})}),l.selectAllCheckbox.addEventListener("change",e=>{const t=e.target.checked;l.testLevelCheckboxes.forEach(e=>{e.checked=t})}),l.testLevelCheckboxes.forEach(e=>{e.addEventListener("change",()=>{const e=Array.from(l.testLevelCheckboxes).every(e=>e.checked),t=Array.from(l.testLevelCheckboxes).every(e=>!e.checked);l.selectAllCheckbox.checked=e,l.selectAllCheckbox.indeterminate=!e&&!t})}),l.advancedToggle.addEventListener("click",()=>{l.advancedOptions.classList.contains("hidden")?(l.advancedOptions.classList.remove("hidden"),l.toggleIcon.classList.add("rotated")):(l.advancedOptions.classList.add("hidden"),l.toggleIcon.classList.remove("rotated"))}),l.fileInput.addEventListener("change",c),l.form.addEventListener("submit",p),l.latestBtn&&l.latestBtn.addEventListener("click",f),function(){const e=o(".file-upload-area");function t(e){e.preventDefault(),e.stopPropagation()}function n(t){e.classList.add("drag-over")}function s(t){e.classList.remove("drag-over")}function a(e){const t=e.dataTransfer.files;l.fileInput.files=t,c({target:{files:t}})}["dragenter","dragover","dragleave","drop"].forEach(o=>{e.addEventListener(o,t,!1),document.body.addEventListener(o,t,!1)}),["dragenter","dragover"].forEach(t=>{e.addEventListener(t,n,!1)}),["dragleave","drop"].forEach(t=>{e.addEventListener(t,s,!1)}),e.addEventListener("drop",a,!1)}(),l.exportBtn&&l.exportMenu&&(l.exportBtn.addEventListener("click",e=>{e.stopPropagation();const t=l.exportBtn.parentElement,o=t.classList.contains("open");document.querySelectorAll(".export-dropdown.open").forEach(e=>{e.classList.remove("open"),e.querySelector(".export-menu").classList.add("hidden")}),o||(t.classList.add("open"),l.exportMenu.classList.remove("hidden"))}),l.exportJson&&l.exportJson.addEventListener("click",v),l.exportExcel&&l.exportExcel.addEventListener("click",h),document.addEventListener("click",e=>{var t,o;const n=null==(t=l.exportBtn)?void 0:t.parentElement;n&&!n.contains(e.target)&&(n.classList.remove("open"),null==(o=l.exportMenu)||o.classList.add("hidden"))})),async function(){try{const e=await fetch(t.llmModels);e.ok?(r=await e.json(),function(){const e=l.llmModel;e.innerHTML='<option value="">Select an AI model...</option>',Object.entries(r).forEach(([t,o])=>{const n=document.createElement("optgroup");n.label=o.name,o.models.forEach(e=>{const o=document.createElement("option");o.value=e.id,o.textContent=e.name,o.setAttribute("data-provider",t),o.setAttribute("data-description",e.description),n.appendChild(o)}),e.appendChild(n)})}()):(console.error("Failed to load LLM models"),x())}catch(e){console.error("Error loading LLM models:",e),x()}}(),l.llmModel&&l.llmModel.addEventListener("change",L)});
